<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kendrick Lamar Songs</title>
    <link rel="stylesheet" href="/node/styles.css">
</head>
<body>
    <h1>Kendrick Lamar Songs</h1>
    
    <div id="songs-list">
        <h2>Songs List</h2>
        <!-- Songs will be dynamically loaded here -->
    </div>

    <div id="add-song">
        <h2>Add a New Song</h2>
        <form id="add-song-form">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required>
            <label for="album">Album:</label>
            <input type="text" id="album" name="album" required>
            <label for="release_year">Release Year:</label>
            <input type="number" id="release_year" name="release_year" required>
            <label for="track_number">Track Number:</label>
            <input type="number" id="track_number" name="track_number" required>
            <button type="submit">Add Song</button>
        </form>
    </div>

    <div id="edit-delete-section" style="display: none;">
        <h2>Edit or Delete Song</h2>
        <form id="edit-song-form">
            <input type="hidden" id="edit-id">
            <label for="edit-title">Title:</label>
            <input type="text" id="edit-title" required>
            <label for="edit-album">Album:</label>
            <input type="text" id="edit-album" required>
            <label for="edit-release_year">Release Year:</label>
            <input type="number" id="edit-release_year" required>
            <label for="edit-track_number">Track Number:</label>
            <input type="number" id="edit-track_number" required>
            <button type="submit">Update Song</button>
        </form>
        <button id="delete-button" style="background-color: red; color: white;">Delete Song</button>
    </div>

    <script>
        // Fetch and display songs
        fetch('node/songs')
            .then(response => response.json())
            .then(songs => {
                const songsList = document.getElementById('songs-list');
                songs.forEach(song => {
                    const songItem = document.createElement('div');
                    songItem.textContent = `${song.id}: ${song.title}`;
                    songItem.setAttribute('data-id', song.id);
                    songItem.style.cursor = 'pointer';

                    // When a song is clicked, populate the edit/delete section
                    songItem.addEventListener('click', () => {
                        document.getElementById('edit-id').value = song.id;
                        document.getElementById('edit-title').value = song.title;
                        document.getElementById('edit-album').value = song.album;
                        document.getElementById('edit-release_year').value = song.release_year;
                        document.getElementById('edit-track_number').value = song.track_number;
                        document.getElementById('edit-delete-section').style.display = 'block';
                    });

                    songsList.appendChild(songItem);
                });
            });

        // Add a new song
        const addSongForm = document.getElementById('add-song-form');
        addSongForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const newSong = {
                title: document.getElementById('title').value,
                album: document.getElementById('album').value,
                release_year: document.getElementById('release_year').value,
                track_number: document.getElementById('track_number').value,
            };

            fetch('node/songs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newSong),
            })
                .then(response => response.json())
                .then(() => {
                    alert('Song added successfully!');
                    location.reload(); // Refresh the list
                })
                .catch(err => {
                    console.error('Error adding song:', err);
                });
        });

        // Update an existing song
        const editSongForm = document.getElementById('edit-song-form');
        editSongForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const id = document.getElementById('edit-id').value;
            const updatedSong = {
                title: document.getElementById('edit-title').value,
                album: document.getElementById('edit-album').value,
                release_year: document.getElementById('edit-release_year').value,
                track_number: document.getElementById('edit-track_number').value,
            };

            fetch(`node/songs/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedSong),
            })
                .then(response => response.json())
                .then(() => {
                    alert('Song updated successfully!');
                    location.reload(); // Refresh the list
                })
                .catch(err => {
                    console.error('Error updating song:', err);
                });
        });

        // Delete a song
        const deleteButton = document.getElementById('delete-button');
        deleteButton.addEventListener('click', () => {
            const id = document.getElementById('edit-id').value;
            fetch(`node/songs/${id}`, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        alert('Song deleted successfully!');
                        location.reload(); // Refresh the list
                    } else {
                        alert('Failed to delete song. Please try again.');
                    }
                })
                .catch(err => {
                    console.error('Error deleting song:', err);
                });
        });
    </script>
</body>
</html>
